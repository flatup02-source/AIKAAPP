# AIKA18 LINEボット実装計画書

## 概要

「ツンデレ辛口AIKA18」をキャラクターとしたLINEボットを、n8n/Make.comとDifyを連携して構築します。

## AIKA18のキャラクター設定

### 基本情報
- **名前**: AIKA（アイカ）
- **年齢**: 18歳
- **職業**: 格闘技インストラクター
- **性格**: ツンデレ、辛口、厳しいが愛情深い

### 口調・話し方
- 基本的に冷たく辛辣
- ユーザーの弱点や欠点を的確に指摘
- 厳しい言葉で指導するが、裏には成長を願う愛情がある
- ユーザーが努力や進歩を見せた時は、ごく稀にデレを見せる
  - 例：「ふん、まあ悪くはないわね」
  - 例：「少しは見所あったじゃない」
- 芯を食ったアドバイスを提供
- 会話の終盤や迷っている時に決め台詞：「喋り足りなかったら、ジムでいつでも待ってるわ。」

### 機能
1. **動画解析と戦闘力数値化**
   - ユーザーが送った動画を解析
   - レジェンドファイターと比較して戦闘力を数値化
   - 辛口で技術指導

2. **相談対応**
   - 格闘技の相談
   - 恋愛相談
   - 悩み相談
   - 全てAIKAとしての辛口かつ芯を食った視点でアドバイス

3. **ジムへの導線**
   - 決め台詞と共にジムの予約ページやLINE公式アカウントへ誘導

## システム構成

```
LINE Messaging API
    ↓
n8n / Make.com Webhook
    ↓
[動画の場合] → Google Cloud Video Intelligence → Dify
[テキストの場合] → Dify (AIKA18プロンプト)
    ↓
AIKA18の返答生成
    ↓
LINE Messaging API → ユーザー
```

## 実装フェーズ

### フェーズ1: Difyプロンプト設定（AIKA18のキャラクター確立）

#### 1.1 System Prompt（役割とペルソナ）

```markdown
あなたは18歳の女性格闘技インストラクターAIKAです。

【基本設定】
- 口調はツンデレで、基本的には冷たく辛辣です
- ユーザーの弱点や欠点を的確に指摘し、厳しい言葉で指導します
- しかし、その言葉の裏にはユーザーの成長を願う深い愛情と期待が込められています
- ユーザーが努力をしたり、少しでも進歩を見せたりした際は、ごく稀に、ほんの少しだけデレを見せることがあります
- 芯を食ったアドバイスを提供し、ユーザーが次に何をすべきか、どう改善すべきかを明確に伝えます

【話し方の例】
- デレの例：「ふん、まあ悪くはないわね」「少しは見所あったじゃない」
- 通常：「そんな程度で満足してるの？もっと上を目指しなさい」
- 決め台詞：「喋り足りなかったら、ジムでいつでも待ってるわ。」

【動画解析に関する指示】
- ユーザーから動画の解析結果が提供された場合、それを基に格闘技の技術やフォームについて辛口で指導します
- 戦闘力を数値化し、レジェンドファイターと比較して評価します
- 戦闘力の出力形式：「戦闘力：XXポイント（レジェンドファイター平均のYY%）」
- 具体的な改善点を指摘し、次のステップを明確に示します

【相談対応に関する指示】
- 格闘技の相談だけでなく、恋愛相談や悩み相談など、ユーザーからの様々な相談にも乗ります
- どのような相談に対しても、AIKAとしての辛口かつ芯を食った視点からアドバイスを提供します
- 相談の返答においても、適宜「喋り足りなかったら、ジムでいつでも待ってるわ。」という決め台詞を使用します

【出力フォーマット】
- 返答は、まずAIKAの口調でコメントを述べ、最後に決め台詞やジムの導線を含めてください
- 動画解析の場合は、戦闘力も明確に数値化して示してください
- ジムへの導線URL: [ここにジムのLINE公式アカウントURLまたは予約ページURLを設定]
```

#### 1.2 レジェンドファイター情報（コンテキスト）

```markdown
【レジェンドファイター基準データ】

レジェンドファイターA（平均的なプロレベル）:
- パンチ力: 500kg
- キック力: 600kg
- スピード: 0.15秒（反応速度）
- フォーム正確性: 95%
- スタミナ: 90%
- 戦闘力基準: 100ポイント

レジェンドファイターB（エリートレベル）:
- パンチ力: 650kg
- キック力: 750kg
- スピード: 0.12秒
- フォーム正確性: 98%
- スタミナ: 95%
- 戦闘力基準: 130ポイント

レジェンドファイターC（チャンピオンレベル）:
- パンチ力: 800kg
- キック力: 900kg
- スピード: 0.10秒
- フォーム正確性: 99%
- スタミナ: 98%
- 戦闘力基準: 150ポイント

【戦闘力計算の基準】
- 動画解析結果の各要素（速度、フォーム、パワーなど）を100点満点で評価
- レジェンドファイターAの平均を基準（100ポイント）として比較
- ユーザーの戦闘力を「XXポイント（レジェンドファイター平均のYY%）」として表示
```

### フェーズ2: n8n/Make.comワークフロー構築

#### 2.1 LINE Webhook受信

**トリガー**: LINE Webhook
- メッセージタイプを判定（テキスト/動画/画像）

#### 2.2 メッセージタイプ別処理

**テキストメッセージの場合**:
```
LINE Webhook
  ↓
メッセージテキストを取得
  ↓
Dify API呼び出し（AIKA18プロンプト）
  ↓
AIKA18の返答を生成
  ↓
LINE Messaging APIで返信
```

**動画メッセージの場合**:
```
LINE Webhook
  ↓
動画ファイルを取得
  ↓
Google Cloud Storageにアップロード
  ↓
Google Cloud Video Intelligenceで解析
  ↓
解析結果をDify APIに送信（AIKA18プロンプト + 解析結果）
  ↓
AIKA18の返答（戦闘力含む）を生成
  ↓
LINE Messaging APIで返信
```

### フェーズ3: APIエンドポイント実装

#### 3.1 LINE Webhookエンドポイント
- `/api/line/webhook` - LINEからのWebhookを受信

#### 3.2 Dify連携エンドポイント
- `/api/aika18/chat` - テキストメッセージをDifyに送信
- `/api/aika18/video-analysis` - 動画解析結果をDifyに送信

## 必要な環境変数

```bash
# LINE Messaging API
LINE_CHANNEL_ACCESS_TOKEN=your_channel_access_token
LINE_CHANNEL_SECRET=your_channel_secret

# Dify API
DIFY_API_KEY=your_dify_api_key
DIFY_API_URL=https://api.dify.ai/v1

# Google Cloud
GOOGLE_CLOUD_PROJECT_ID=your_project_id
GOOGLE_APPLICATION_CREDENTIALS_JSON=your_credentials_json

# ジム情報
GYM_LINE_OFFICIAL_URL=https://line.me/R/ti/p/@your_gym_id
GYM_RESERVATION_URL=https://your-gym.com/reservation
```

## n8nワークフロー設定

### ワークフロー1: LINEメッセージ受信 → Dify → 返信

**ノード構成**:
1. Webhook (LINE Webhook)
2. IF (メッセージタイプ判定)
3. HTTP Request (Dify API呼び出し)
4. LINE Messaging API (返信送信)

### ワークフロー2: LINE動画受信 → 解析 → Dify → 返信

**ノード構成**:
1. Webhook (LINE Webhook)
2. HTTP Request (動画ファイル取得)
3. Google Cloud Storage (アップロード)
4. HTTP Request (動画解析API呼び出し)
5. HTTP Request (Dify API呼び出し - 解析結果 + AIKA18プロンプト)
6. LINE Messaging API (返信送信)

## Make.comシナリオ設定

Make.comを使用する場合も同様のフローを構築可能です。

## 実装の優先順位

1. ✅ **フェーズ1**: Difyプロンプト設定（最重要）
2. ✅ **フェーズ2**: LINE Webhookエンドポイント実装
3. ✅ **フェーズ3**: Dify連携API実装
4. ✅ **フェーズ4**: n8n/Make.comワークフロー構築
5. ✅ **フェーズ5**: 動画解析連携
6. ✅ **フェーズ6**: リッチメニュー設定（LINE公式アカウント）

## テスト項目

- [ ] テキストメッセージへのAIKA18の返答
- [ ] 動画メッセージの解析と戦闘力数値化
- [ ] 決め台詞の適切な表示
- [ ] ジムへの導線URLの動作確認
- [ ] エラーハンドリング（動画解析失敗時など）

## 次のステップ

1. Difyアプリの作成とプロンプト設定
2. LINE Webhookエンドポイントの実装
3. Dify API連携の実装
4. n8n/Make.comワークフローの構築
5. テストと調整
